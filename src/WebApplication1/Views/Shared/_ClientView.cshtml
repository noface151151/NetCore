@using Microsoft.AspNetCore.Http;
@using WebApplication1.Entites;
@using Newtonsoft.Json;

<!DOCTYPE html>
<html lang="en">
<head>
    <base href="/" />
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Shop Giày Online</title>
    <environment names="Development">
        <!-- Google Fonts -->
        <!-- Bootstrap -->      
        <link href="~/bootstrap.min.css" rel="stylesheet" />
        <!-- Font Awesome -->
        <link href="~/font-awesome-4.6.3/css/font-awesome.css" rel="stylesheet" />
        <!-- Custom CSS -->
        <link href="~/css/owl.carousel.css" rel="stylesheet" />
        <link href="~/css/style.css" rel="stylesheet" />
        <link href="~/css/responsive.css" rel="stylesheet" />
        <link href="~/css/jquery-ui.css" rel="stylesheet" />
    </environment>
</head>
<body>

    <div class="header-area">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="user-menu">
                        <ul>
                            <li><a asp-action="TrangGioHang" asp-controller="GioHang"><i class="fa fa-shopping-cart"></i> Giỏ hàng</a></li>
                            <li><a asp-action="ThanhToan" asp-controller="DonHang"><i class="fa fa-check-square-o" aria-hidden="true"></i> Thanh toán</a></li>
                            <li>
                                <a style="cursor:pointer" data-toggle="modal" data-target="#myModal"><i class="fa fa-user-plus" aria-hidden="true"></i> Đăng ký</a>
                                <div class="modal fade" id="myModal" role="dialog">
                                    <div class="modal-dialog">

                                        <!-- Modal content-->
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                <h4 class="modal-title">Đăng ký</h4>
                                            </div>
                                            <div class="modal-body">
                                                <form id="login-form-wrap" class="login">
                                                    <p class="form-row form-row-first">
                                                        <label for="username">
                                                            Tên đăng nhập <span class="required">*</span>
                                                        </label>
                                                        <input type="text" id="usernameReg" name="username" class="input-text">
                                                    </p>
                                                    <p class="form-row form-row-last">
                                                        <label for="password">
                                                            Mật khẩu <span class="required">*</span>
                                                        </label>
                                                        <input type="password" id="passwordReg" name="password" class="input-text">
                                                    </p>
                                                    <p class="form-row form-row-last">
                                                        <label for="password">
                                                           Nhập lại mật khẩu <span class="required">*</span>
                                                        </label>
                                                        <input type="password" id="Confirmpassword" name="password" class="input-text">
                                                    </p>
                                                    <div class="clear"></div>

                                                    <p class="form-row">
                                                        <input type="button" value="Tạo tài khoản" name="login" class="button" id="btnDangky">
                                                        
                                                    </p>
                                                   
                                                    <div class="clear"></div>
                                                </form>
                                            </div>
                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-default" data-dismiss="modal">Thoát</button>
                                            </div>
                                        </div>

                                    </div>
                                </div>
                            </li>
                           
                                @{
                                    var sessionTaiKhoan = Context.Session.GetString("taikhoan");


                                    if (sessionTaiKhoan != null)
                                    {
                                        var taikhoan = JsonConvert.DeserializeObject<TaiKhoan>(sessionTaiKhoan);
                                        <li>
                                            <a  asp-action="DonHangKhachHang" asp-controller="DonHang" asp-route-makh="@taikhoan.Id" style="cursor:pointer"><i class="fa fa-user"></i>Xin chào @taikhoan.TaiKhoan1</a>
                                        </li>
                                        <li>
                                            <a asp-action="DangXuat" asp-controller="TaiKhoan" style="cursor:pointer"> Đăng xuất</a>
                                        </li>

                                    }
                                    else
                                    {
                                        <li>
                                            <a style="cursor:pointer" data-toggle="modal" data-target="#myModalDN"><i class="fa fa-user"></i> Đăng nhập</a>
                                            <div class="modal fade" id="myModalDN" role="dialog">
                                                <div class="modal-dialog">

                                                    <!-- Modal content-->
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <button type="button" class="close" data-dismiss="modal">&times;</button>
                                                            <h4 class="modal-title">Đăng nhập</h4>
                                                        </div>
                                                        <div class="modal-body">
                                                            <form id="login-form-wrap" class="login">
                                                                <p class="form-row form-row-first">
                                                                    <label for="username">
                                                                        Tên đăng nhập <span class="required">*</span>
                                                                    </label>
                                                                    <input type="text" id="usernameLog" name="username" class="input-text">
                                                                </p>
                                                                <p class="form-row form-row-last">
                                                                    <label for="password">
                                                                        Mật khẩu <span class="required">*</span>
                                                                    </label>
                                                                    <input type="password" id="passwordLog" name="password" class="input-text">
                                                                </p>
                                                                <div class="clear"></div>

                                                                <p class="form-row">
                                                                    <input type="button" value="Đăng nhập" name="login" class="button" id="btnDangnhap">

                                                                </p>

                                                                <div class="clear"></div>
                                                            </form>
                                                        </div>
                                                        <div class="modal-footer">
                                                            <button type="button" class="btn btn-default" data-dismiss="modal">Thoát</button>
                                                        </div>
                                                    </div>

                                                </div>
                                            </div>
                                        </li>
                                    }

                                }

     
                        </ul>
                    </div>
                </div>


            </div>
        </div>
    </div> <!-- End header area -->

    <div class="site-branding-area">
        <div class="container">
            <div class="row">
                <div class="col-sm-6">
                    <div class="logo">
                        <h1><a href="#"><span>Shop Giày Online</span></a></h1>
                    </div>
                </div>

                <div class="col-sm-6" id="GioHang">
                    @await Component.InvokeAsync("GioHang")
                </div>
            </div>
        </div>
    </div> <!-- End site branding area -->


    <div class="mainmenu-area">
        <div class="container">
            <div class="row">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                        <span class="sr-only">Toggle navigation</span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                    </button>
                </div>
                <div class="navbar-collapse collapse" id="menu" ng-controller="MenuController">
                    <ul class="nav navbar-nav">
                        <li class="active"><a asp-action="Index" asp-controller="Home">Trang chủ</a></li>
                        <li>
                            <a href="#">Sản phẩm</a>
                            @await Component.InvokeAsync("LoaiSP")
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </div> <!-- End mainmenu area -->
    <!--Renderbody tu day-->

   @RenderBody()



    <div class="footer-bottom-area">
        <div class="container">
            <div class="row">
                <div class="col-md-8">
                    <div class="copyright">
                        <p>&copy; Shop giày online</p>
                    </div>
                </div>


            </div>
        </div>
    </div> <!-- End footer bottom area -->
    <environment names="Development">
        <!-- Latest jQuery form server -->
        <script src="~/Script/jquery-3.1.1.min.js"></script>
        <!-- Bootstrap JS form CDN -->
        <script src="~/Script/bootstrap.min.js"></script>
        <!-- jQuery sticky menu -->
        <script src="~/Script/owl.carousel.min.js"></script>
        <script src="~/Script/jquery.sticky.js"></script>
        <!-- jQuery easing -->
        <script src="~/Script/jquery.easing.1.3.min.js"></script>
        <!-- Main Script -->
        <script src="~/Script/main.js"></script>
        <script src="~/Script/jquery-ui.js"></script>
        <script type="text/javascript">
            $(document).ready(function () {
                $("#btnDangky").click(function () {
                    var username=$("#usernameReg").val();
                    var pass=$("#passwordReg").val();
                    var comfirmpass=$("#Confirmpassword").val();
                    if(username==""||pass==""||comfirmpass=="")
                    {
                        alert("Nhập thiếu thông tin");
                    }
                    else if(pass!=comfirmpass)
                    {

                        alert("Mật khẩu xác nhận không đúng");
                    }
                    else {
                        var taikhoan={TaiKhoan1:username,MatKhau:pass};
                        $.ajax({
                            type: 'POST',
                            data: JSON.stringify(taikhoan),
                            url:'@Url.Action("DangKy","TaiKhoan")',
                            datatype: 'json',
                            contentType: 'application/json',
                            success: function (resp) {
                                if(resp.status==true)
                                {
                                    $("#myModal").modal('toggle');
                                    alert("Đăng ký thành công")

                                }
                                else {
                                    alert("Đăng ký thất bại")

                                }

                            }

                        })

                    }
                })
                $("#btnDangnhap").click(function () {
                    var username = $("#usernameLog").val();
                    var pass = $("#passwordLog").val();
                    if (username == "" || pass == "") {
                        alert("Nhập thiếu thông tin");
                    }
                    else {
                        var taikhoan = { TaiKhoan1: username, MatKhau: pass };
                        $.ajax({
                            type: 'POST',
                            data: JSON.stringify(taikhoan),
                            url: '@Url.Action("DangNhap", "TaiKhoan")',
                            datatype: 'json',
                            contentType: 'application/json',
                            success: function (resp) {
                                if (resp.data == 0)
                                {
                                    alert("Không tồn tại tài khoản")

                                }
                                else if (resp.data == 1) {
                                    alert("Mật khẩu không đúng")

                                }
                                else
                                {
                                    location.reload();

                                }
                            }

                        })

                    }
                })
                $("#datepicker").datepicker({
                    minDate: new Date(),
                    dateFormat: "dd-mm-yy"
                });
            })
        </script>
        @RenderSection("jsFooter",required:false)
    </environment>
    
</body>
</html>